
[INGEST: vendor=msft, product=graph_security, target_dataset=msft_graph_security_raw, no_hit=keep]
| alter evidence_microsoft_graph_security_deviceEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.deviceEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_deviceEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_deviceEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_deviceEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_deviceEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_deviceEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_deviceEvidence -> tags[]
| alter evidence_firstSeenDateTime = evidence_microsoft_graph_security_deviceEvidence -> ["firstSeenDateTime"]
| alter evidence_mdeDeviceId = evidence_microsoft_graph_security_deviceEvidence -> ["mdeDeviceId"]
| alter evidence_azureAdDeviceId = evidence_microsoft_graph_security_deviceEvidence -> ["azureAdDeviceId"]
| alter evidence_deviceDnsName = evidence_microsoft_graph_security_deviceEvidence -> ["deviceDnsName"]
| alter evidence_osPlatform = evidence_microsoft_graph_security_deviceEvidence -> ["osPlatform"]
| alter evidence_osBuild = evidence_microsoft_graph_security_deviceEvidence -> osBuild
| alter evidence_version = evidence_microsoft_graph_security_deviceEvidence -> ["version"]
| alter evidence_healthStatus = evidence_microsoft_graph_security_deviceEvidence -> ["healthStatus"]
| alter evidence_riskScore = evidence_microsoft_graph_security_deviceEvidence -> ["riskScore"]
| alter evidence_rbacGroupId = evidence_microsoft_graph_security_deviceEvidence -> rbacGroupId
| alter evidence_rbacGroupName = evidence_microsoft_graph_security_deviceEvidence -> ["rbacGroupName"]
| alter evidence_onboardingStatus = evidence_microsoft_graph_security_deviceEvidence -> ["onboardingStatus"]
| alter evidence_defenderAvStatus = evidence_microsoft_graph_security_deviceEvidence -> ["defenderAvStatus"]
| alter evidence_lastIpAddress = evidence_microsoft_graph_security_deviceEvidence -> ["lastIpAddress"]
| alter evidence_lastExternalIpAddress = evidence_microsoft_graph_security_deviceEvidence -> ["lastExternalIpAddress"]
| alter evidence_ipInterfaces = evidence_microsoft_graph_security_deviceEvidence -> ipInterfaces[]
| alter evidence_loggedOnUsers = evidence_microsoft_graph_security_deviceEvidence -> loggedOnUsers[]
| alter evidence_microsoft_graph_security_userEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.userEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_userEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_userEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_userEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_userEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_userEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_userEvidence -> tags[]
| alter evidence_userAccount = evidence_microsoft_graph_security_userEvidence -> userAccount{}
| alter evidence_userAccount_accountName = evidence_userAccount -> accountName
| alter evidence_userAccount_domainName = evidence_userAccount -> domainName
| alter evidence_userAccount_userSid = evidence_userAccount -> userSid
| alter evidence_userAccount_azureAdUserId = evidence_userAccount -> azureAdUserId
| alter evidence_userAccount_userPrincipalName = evidence_userAccount -> userPrincipalName
| alter evidence_microsoft_graph_security_fileEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.fileEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_fileEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_fileEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_fileEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_fileEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_fileEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_fileEvidence -> tags[]
| alter evidence_detectionStatus = evidence_microsoft_graph_security_fileEvidence -> ["detectionStatus"]
| alter evidence_mdeDeviceId = evidence_microsoft_graph_security_fileEvidence -> ["mdeDeviceId"]
| alter evidence_fileDetails = evidence_microsoft_graph_security_fileEvidence -> fileDetails{}
| alter evidence_fileDetails_sha1 = evidence_fileDetails -> sha1
| alter evidence_fileDetails_sha256 = evidence_fileDetails -> sha256
| alter evidence_fileDetails_fileName = evidence_fileDetails -> fileName
| alter evidence_fileDetails_filePath = evidence_fileDetails -> filePath
| alter evidence_fileDetails_fileSize = evidence_fileDetails -> fileSize
| alter evidence_microsoft_graph_security_urlEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.urlEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_urlEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_urlEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_urlEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_urlEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_urlEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_urlEvidence -> tags[]
| alter evidence_url = evidence_microsoft_graph_security_urlEvidence -> ["url"]
| alter evidence_microsoft_graph_security_urlEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.urlEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_urlEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_urlEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_urlEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_urlEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_urlEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_urlEvidence -> tags[]
| alter evidence_url = evidence_microsoft_graph_security_urlEvidence -> ["url"]
| alter evidence_microsoft_graph_security_processEvidence = arrayindex(arrayfilter(json_extract_array(evidence,"$"),"@element" contains "#microsoft.graph.security.processEvidence"),0)
| alter evidence_createdDateTime = evidence_microsoft_graph_security_processEvidence -> ["createdDateTime"]
| alter evidence_verdict = evidence_microsoft_graph_security_processEvidence -> ["verdict"]
| alter evidence_remediationStatus = evidence_microsoft_graph_security_processEvidence -> ["remediationStatus"]
| alter evidence_roles = evidence_microsoft_graph_security_processEvidence -> roles[]
| alter evidence_detailedRoles = evidence_microsoft_graph_security_processEvidence -> detailedRoles[]
| alter evidence_tags = evidence_microsoft_graph_security_processEvidence -> tags[]
| alter evidence_processId = evidence_microsoft_graph_security_processEvidence -> processId
| alter evidence_parentProcessId = evidence_microsoft_graph_security_processEvidence -> parentProcessId
| alter evidence_processCommandLine = evidence_microsoft_graph_security_processEvidence -> ["processCommandLine"]
| alter evidence_processCreationDateTime = evidence_microsoft_graph_security_processEvidence -> ["processCreationDateTime"]
| alter evidence_parentProcessCreationDateTime = evidence_microsoft_graph_security_processEvidence -> ["parentProcessCreationDateTime"]
| alter evidence_detectionStatus = evidence_microsoft_graph_security_processEvidence -> ["detectionStatus"]
| alter evidence_mdeDeviceId = evidence_microsoft_graph_security_processEvidence -> ["mdeDeviceId"]
| alter evidence_imageFile = evidence_microsoft_graph_security_processEvidence -> imageFile{}
| alter evidence_imageFile_sha1 = evidence_imageFile -> sha1
| alter evidence_imageFile_sha256 = evidence_imageFile -> sha256
| alter evidence_imageFile_fileName = evidence_imageFile -> fileName
| alter evidence_imageFile_filePath = evidence_imageFile -> filePath
| alter evidence_imageFile_fileSize = evidence_imageFile -> fileSize
| alter evidence_imageFile_filePublisher = evidence_imageFile -> filePublisher
| alter evidence_parentProcessImageFile = evidence_microsoft_graph_security_processEvidence -> parentProcessImageFile{}
| alter evidence_parentProcessImageFile_fileName = evidence_parentProcessImageFile -> fileName
| alter evidence_parentProcessImageFile_filePath = evidence_parentProcessImageFile -> filePath
| alter evidence_parentProcessImageFile_fileSize = evidence_parentProcessImageFile -> fileSize
| alter evidence_parentProcessImageFile_filePublisher = evidence_parentProcessImageFile -> filePublisher
| alter evidence_userAccount = evidence_microsoft_graph_security_processEvidence -> userAccount{}
| alter evidence_userAccount_accountName = evidence_userAccount -> accountName
| alter evidence_userAccount_domainName = evidence_userAccount -> domainName
| alter evidence_userAccount_userSid = evidence_userAccount -> userSid
| alter evidence_userAccount_azureAdUserId = evidence_userAccount -> azureAdUserId
| alter evidence_userAccount_userPrincipalName = evidence_userAccount -> userPrincipalName

